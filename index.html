<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Livefy TV (Create By HASAN)</title>
    
    <!-- External Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/hls.js@1"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.30.1/moment.min.js"></script>
    
    <!-- Firebase SDKs -->
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700;900&display=swap" rel="stylesheet">

<style>
/* আপনার দেওয়া সম্পূর্ণ সিএসএস (CSS) এখানে রয়েছে। কোনো পরিবর্তন করা হয়নি। */
:root { --bg-main: #0D0D10; --bg-card: rgba(35, 35, 45, 0.5); --primary-color: #A020F0; --secondary-color: #00F5FF; --text-light: #F0F0F0; --text-dark: #A0A0A0; --live-red: #FF3B3B; --font-main: 'Poppins', sans-serif; } body { font-family: var(--font-main); background: radial-gradient(circle at top left, rgba(160, 32, 240, 0.15), transparent 40%), radial-gradient(circle at bottom right, rgba(0, 245, 255, 0.15), transparent 40%), var(--bg-main); color: var(--text-light); margin: 0; padding: 0; padding-bottom: 90px; overflow-x: hidden; } .main-header { background: transparent; color: white; padding: 8px 10px; text-align: center; font-size: 28px; font-weight: 900; letter-spacing: 4px; text-transform: uppercase; text-shadow: 0 0 10px var(--primary-color), 0 0 20px var(--primary-color), 0 0 30px var(--secondary-color); margin-bottom: 0; border-bottom: 1px solid rgba(255, 255, 255, 0.1); } .welcome-box { background-color: #333; padding: 5px; border: 2px solid var(--primary-color); margin-top: 5px; overflow: hidden; position: relative; } .welcome-text { display: inline-block; white-space: nowrap; animation: marquee 110s linear infinite; font-size: 20px; color: var(--secondary-color); font-weight: bold; } @keyframes marquee { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } } .content { padding: 10px; max-width: 600px; margin: 0 auto; padding-top: 20px; } .section-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; padding-bottom: 5px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); } .section-header h2 { font-size: 22px; font-weight: bold; color: white; margin: 0; min-width: 120px; } .datetime-box { background: linear-gradient(45deg, var(--primary-color), var(--secondary-color)); color: black; padding: 5px 10px; border-radius: 8px; font-size: 10px; font-weight: bold; text-align: right; line-height: 1.2; box-shadow: 0 2px 10px rgba(160, 32, 240, 0.5); min-width: 90px; } .datetime-box .date-text { color: #222; } .join-now-link { text-decoration: none; background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); color: #000; padding: 6px 12px; border-radius: 50px; font-size: 14px; font-weight: 700; transition: all 0.3s; white-space: nowrap; border: none; box-shadow: 0 0 10px var(--primary-color); } .join-now-link:hover { transform: scale(1.05); box-shadow: 0 0 20px var(--secondary-color); } .match-tabs { display: flex; justify-content: center; gap: 8px; margin: 25px 0; background-color: transparent; border-radius: 50px; padding: 5px; box-shadow: none; } .match-tab-btn { padding: 8px 18px; border: 1px solid var(--bg-card); border-radius: 50px; background-color: var(--bg-card); color: var(--text-dark); font-size: 13px; font-weight: 600; cursor: pointer; transition: all 0.4s ease; backdrop-filter: blur(10px); white-space: nowrap; } .match-tab-btn:hover { background-color: rgba(160, 32, 240, 0.5); color: var(--text-light); } .match-tab-btn.active-tab { background: linear-gradient(90deg, var(--primary-color), var(--secondary-color)); color: #000; border-color: transparent; box-shadow: 0 0 15px var(--primary-color); transform: translateY(0); } .match-card { background: var(--bg-card); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; margin-bottom: 15px; padding: 5px 8px; text-align: center; box-shadow: 0 8px 35px 0 rgba(0, 0, 0, 0.37); backdrop-filter: blur(10px); -webkit-backdrop-filter: blur(10px); cursor: pointer; transition: all 0.3s ease; position: relative; overflow: hidden; } .match-card::before { content: ''; position: absolute; top: -50%; left: -50%; width: 200%; height: 200%; background: conic-gradient( transparent, rgba(255, 59, 59, 0.7), transparent 30% ); animation: rotate 6s linear infinite; opacity: 0; transition: opacity 0.5s ease; } .match-card:hover { transform: translateY(-5px); box-shadow: 0 0 25px rgba(160, 32, 240, 0.5); border-color: var(--primary-color); } .team { display: flex; justify-content: space-around; align-items: center; margin: 6px 0; } .team > div { flex: 1; } .match-info { flex: 0 0 70px; } .team img { width: 45px; height: 45px; border-radius: 50%; border: 2px solid rgba(255, 255, 255, 0.2); padding: 2px; background-color: rgba(0,0,0,0.3); } .team-name { font-size: 11px; font-weight: 600; margin-top: 5px; min-height: 24px; } .time { font-size: 15px; font-weight: 700; } .date { font-size: 10px; color: var(--text-dark); margin-top: 1px; } .live-animation { position: relative; display: inline-flex; align-items: center; color: var(--live-red); font-size: 14px; font-weight: bold; text-shadow: 0 0 10px var(--live-red); } .live-animation::before { content: ''; display: block; width: 8px; height: 8px; background-color: var(--live-red); border-radius: 50%; margin-right: 8px; box-shadow: 0 0 5px var(--live-red), 0 0 10px var(--live-red); animation: live-pulse 1.5s infinite; } @keyframes live-pulse { 0% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(255, 59, 59, 0.7); } 70% { transform: scale(1); box-shadow: 0 0 0 10px rgba(255, 59, 59, 0); } 100% { transform: scale(0.8); box-shadow: 0 0 0 0 rgba(255, 59, 59, 0); } } .countdown-text { color: var(--secondary-color); font-size: 13px; font-weight: bold; margin-top: 2px; } .full-time-text { color: #ffd700; font-size: 13px; font-weight: bold; margin-top: 2px; } .match-stage { background-color: rgba(0,0,0,0.3); color: var(--text-dark); padding: 3px 8px; border-radius: 50px; font-size: 10px; display: inline-block; margin-top: 6px; } .channel-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr)); gap: 12px; padding-top: 10px; } .channel-item { position: relative; background: var(--bg-card); border-radius: 12px; overflow: hidden; cursor: pointer; transition: all 0.3s ease; border: 1px solid rgba(255, 255, 255, 0.1); backdrop-filter: blur(10px); aspect-ratio: 1 / 1; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 10px; box-shadow: 0 4px 8px rgba(0, 0, 0, 0.4); } .channel-item:hover { transform: translateY(-5px); box-shadow: 0 8px 25px rgba(0, 245, 255, 0.4); border-color: var(--secondary-color); } .channel-logo { width: 60%; max-height: 45px; object-fit: contain; margin-bottom: 8px; } .channel-name { font-size: 12px; font-weight: bold; color: #eee; text-align: center; line-height: 1.2; } .play-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; opacity: 0; transition: opacity 0.3s ease; pointer-events: none; } .channel-item:hover .play-overlay { opacity: 1; } .play-icon { font-size: 32px; color: var(--secondary-color); text-shadow: 0 0 15px var(--secondary-color); } .bottom-nav { position: fixed; bottom: 15px; left: 50%; transform: translateX(-50%); width: 90%; max-width: 400px; background-color: rgba(20, 20, 25, 0.7); backdrop-filter: blur(15px); -webkit-backdrop-filter: blur(15px); display: flex; justify-content: space-around; padding: 10px 0; border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 50px; z-index: 999; box-shadow: 0 5px 20px rgba(0,0,0,0.5); } .nav-item { display: flex; flex-direction: column; align-items: center; color: var(--text-dark); cursor: pointer; transition: all 0.3s ease; padding: 5px 10px; } .nav-item.active { color: var(--primary-color); transform: scale(1.1); } .nav-item.active svg { filter: drop-shadow(0 0 8px var(--primary-color)); } .nav-item span { font-size: 12px; margin-top: 3px; font-weight: bold; } .nav-item svg { width: 24px; height: 24px; } .hidden { display: none !important; } .alert-btn { background-color: #ffc107; color: #000; border: none; padding: 6px 12px; font-size: 14px; font-weight: bold; border-radius: 8px; cursor: pointer; transition: background-color 0.3s; display: flex; align-items: center; gap: 6px; animation: pulse-glow 2s infinite linear; } .alert-btn .fa-bell { animation: bell-shake 4s infinite ease-in-out 1s; } @keyframes pulse-glow { 0% { box-shadow: 0 0 5px rgba(255, 193, 7, 0.4), 0 0 10px rgba(255, 193, 7, 0.3); } 70% { box-shadow: 0 0 15px rgba(255, 193, 7, 0.8), 0 0 25px rgba(255, 193, 7, 0.6); } 100% { box-shadow: 0 0 5px rgba(255, 193, 7, 0.4), 0 0 10px rgba(255, 193, 7, 0.3); } } @keyframes bell-shake { 0%, 50%, 100% { transform: rotate(0); } 10%, 30% { transform: rotate(-15deg); } 20%, 40% { transform: rotate(15deg); } } .alert-modal { display: none; position: fixed; z-index: 2000; left: 0; top: 0; width: 100%; height: 100%; overflow: auto; background-color: rgba(0, 0, 0, 0.85); justify-content: center; align-items: center; padding: 15px; box-sizing: border-box; } .alert-modal-content { background-color: #222; margin: auto; padding: 20px; border: 1px solid #ffc107; border-radius: 10px; width: 100%; max-width: 380px; box-shadow: 0 5px 25px rgba(255, 193, 7, 0.2); position: relative; text-align: center; } .alert-close-btn { color: #aaa; position: absolute; top: 5px; right: 10px; font-size: 28px; font-weight: bold; cursor: pointer; transition: color 0.3s; background: none; border: none; } .alert-close-btn:hover { color: #ffc107; } .alert-content h3 { color: #ffc107; margin-top: 0; margin-bottom: 15px; font-size: 22px; } .alert-content p { color: #ddd; font-size: 15px; line-height: 1.5; margin-bottom: 10px; } .highlight-card { text-align: left; display: flex; gap: 10px; align-items: center; padding: 10px; background: var(--bg-card); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 16px; margin-bottom: 20px; backdrop-filter: blur(10px); } .highlight-card:hover { transform: scale(1.03); border-color: var(--primary-color);} .highlight-card .info { flex-grow: 1; } .highlight-card img { width: 70px; height: 70px; object-fit: cover; border-radius: 8px; border: 1px solid var(--primary-color); } .banner { padding: 0; overflow: hidden; border: 1px solid var(--primary-color); cursor: pointer; transform: none; transition: none; margin-top: 25px; border-radius: 10px; } .banner-image { width: 100%; height: auto; display: block; border-radius: 10px; } .banner:hover { transform: none; } .match-title { background-color: #000; color: #fff; display: inline-block; padding: 2px 6px; border-radius: 10px; font-size: 10px; font-weight: bold; margin-bottom: 5px; } .match-status-wrapper { min-height: 35px; display: flex; flex-direction: column; justify-content: center; align-items: center; } #video-player { display: none; position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background-color: rgba(13, 13, 16, 0.8); backdrop-filter: blur(20px); z-index: 1000; justify-content: center; align-items: center; flex-direction: column; padding: 10px; box-sizing: border-box; overflow-y: auto; } #video-container-wrapper { position: relative; width: 100%; max-width: 900px; background-color: black; border-radius: 15px; box-shadow: 0 0 25px var(--primary-color); } .video-wrapper { position: relative; width: 100%; padding-top: 56.25%; overflow: hidden; border: 4px solid var(--secondary-color); border-radius: 15px; box-shadow: inset 0 0 10px var(--secondary-color); } #video { position: absolute; top: 0; left: 0; width: 100%; height: 100%; filter: brightness(1); } #video-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-color: transparent; z-index: 50; pointer-events: none; } #livefy-text-animator { position: absolute; bottom: 10px; right: 10px; color: var(--secondary-color); font-size: 14px; font-weight: 900; opacity: 0.8; z-index: 60; background-color: rgba(0, 0, 0, 0.7); padding: 4px 8px; border-radius: 5px; border: 1px solid var(--secondary-color); box-shadow: 0 0 5px var(--secondary-color); animation: watermark-blink 5s infinite; display: none; } .is-loading { color: #FF003C !important; font-size: 16px; padding: 5px 10px; border-color: #FF003C !important; box-shadow: 0 0 15px rgba(255, 0, 60, 0.8) !important; animation: pulse 1s infinite !important; } @keyframes pulse { 0% { transform: scale(1); opacity: 1; } 50% { transform: scale(1.05); opacity: 0.8; } 100% { transform: scale(1); opacity: 1; } } @keyframes watermark-blink { 0%, 100% { opacity: 0.8; } 50% { opacity: 0.5; } } #error-message-box { background-color: #1a1a1a; border: 3px solid #FF003C; padding: 10px; border-radius: 12px; text-align: center; max-width: 95%; width: 350px; margin-top: 20px; box-shadow: 0 0 15px rgba(255, 0, 60, 0.6); display: none; position: relative; } #error-title { color: #FF003C; font-size: 20px; margin-bottom: 5px; font-weight: bold; } #error-text { color: #ddd; font-size: 14px; } #error-message-box .close-error-btn { position: absolute; top: -10px; right: -10px; font-size: 18px; color: white; background-color: var(--live-red); border: 2px solid #fff; border-radius: 50%; width: 30px; height: 30px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 100; } #controls-area { width: 100%; max-width: 900px; margin-top: 20px; padding: 10px; background-color: rgba(0,0,0,0.3); backdrop-filter: blur(10px); border-radius: 10px; box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5); } #quality-selector-container { display: flex; justify-content: space-between; align-items: center; padding: 10px 0; color: var(--secondary-color); font-size: 16px; font-weight: bold; margin-bottom: 15px; border-bottom: 2px solid #333; } #quality-select { background-color: #000; color: var(--secondary-color); border: 1px solid var(--secondary-color); padding: 8px 12px; border-radius: 8px; font-size: 14px; cursor: pointer; outline: none; transition: border-color 0.3s; } #quality-select:focus { border-color: var(--primary-color); } #server-buttons { display: flex; justify-content: center; flex-wrap: wrap; gap: 15px; } .server-button { background-color: #333; color: var(--secondary-color); border: 1px solid var(--secondary-color); border-radius: 20px; padding: 10px 20px; font-size: 16px; font-weight: 700; cursor: pointer; transition: all 0.3s ease; flex: 1 1 calc(50% - 15px); box-sizing: border-box; max-width: 300px; } .server-button:hover { background-color: var(--secondary-color); color: black; box-shadow: 0 0 10px var(--secondary-color); } .server-button.active-server { background-color: var(--primary-color); color: white; border: 2px solid #fff; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(160, 32, 240, 0.6); } #close-btn { position: absolute; top: -15px; right: -15px; font-size: 22px; color: white; background-color: var(--live-red); border: 3px solid #fff; border-radius: 50%; width: 45px; height: 45px; display: flex; align-items: center; justify-content: center; cursor: pointer; z-index: 10; transition: all 0.3s; box-shadow: 0 0 15px rgba(255, 59, 59, 1); } #close-btn:hover { background-color: #FF003C; transform: scale(1.1); } #close-btn:active { transform: scale(0.95); box-shadow: 0 0 5px rgba(200, 8, 21, 0.8); } @media (max-width: 600px) { #close-btn { top: 10px; right: 10px; width: 35px; height: 35px; font-size: 16px; } }
</style>
</head>
<body>
    <header class="main-header"> LIVEFY TV </header>
    <div class="welcome-box">
        <div class="welcome-text" id="welcome-text-container">Loading welcome message...</div>
    </div>

    <!-- Alert Modal (পপ-আপ) -->
    <div id="alert-modal" class="alert-modal">
        <div class="alert-modal-content">
            <button class="alert-close-btn" onclick="closeAlert()">&times;</button>
            <div class="alert-content">
                <h3 id="alert-title-container">Loading Title...</h3>
                <p id="alert-message-container">Loading message...</p>
            </div>
        </div>
    </div>

    <div class="content">
        <div id="home-section">
            <div class="section-header">
                <h2>
                    <button class="alert-btn" onclick="showAlert()">
                        <i class="fas fa-bell"></i> Alert
                    </button>
                </h2>
                <a href="#" id="telegram-link" class="join-now-link" target="_blank" rel="noopener noreferrer">
                    <i class="fab fa-telegram-plane"></i> Join Now
                </a>
                <div id="time-display-home" class="datetime-box"></div>
            </div>

            <div class="banner" id="home-banner-top">
                 <a href="#" target="_blank" rel="noopener noreferrer">
                    <img src="https://placehold.co/600x100/111/fff?text=Loading Ad..." alt="Home Section Banner" class="banner-image">
                </a>
            </div>
            
            <div class="match-tabs">
                <button class="match-tab-btn active-tab" onclick="filterMatches('all', this)">ALL</button>
                <button class="match-tab-btn" onclick="filterMatches('live', this)">LIVE</button>
                <button class="match-tab-btn" onclick="filterMatches('upcoming', this)">UPCOMING</button>
                <button class="match-tab-btn" onclick="filterMatches('recent', this)">RECENT</button>
            </div>

            <div id="match-list-container">
                <!-- Match cards will be dynamically inserted here from Firebase -->
            </div>
            
             <div class="banner" id="home-banner-bottom">
                <a href="#" target="_blank" rel="noopener noreferrer">
                    <img src="https://placehold.co/600x100/111/fff?text=Loading Ad..." alt="Home Section Banner 2" class="banner-image">
                </a>
            </div>
        </div>
        
        <div id="sports-channels-section" class="hidden">
            <div class="section-header"> 
                <h2>Live TV</h2> 
                <a href="#" id="telegram-link-channels" class="join-now-link" target="_blank" rel="noopener noreferrer"> 
                    <i class="fab fa-telegram-plane"></i> Join Now 
                </a> 
                <div id="time-display-channels" class="datetime-box"></div> 
            </div> 
            <div class="channel-grid" id="channel-grid-container"> 
                <!-- Live TV Channels will be dynamically inserted here from Firebase -->
            </div> 
            <div class="banner" id="channels-banner"> 
                <a href="#" target="_blank" rel="noopener noreferrer"> 
                    <img src="https://placehold.co/600x100/111/fff?text=Loading Ad..." alt="Channels Section Banner" class="banner-image">
                </a> 
            </div> 
        </div>
        
        <div id="highlights-section" class="hidden"> 
            <div class="section-header"> 
                <h2>Highlights</h2> 
                <a href="#" id="telegram-link-highlights" class="join-now-link" target="_blank" rel="noopener noreferrer"> 
                    <i class="fab fa-telegram-plane"></i> Join Now 
                </a> 
                <div id="time-display-highlights" class="datetime-box"></div> 
            </div>
            <div id="highlights-container">
                <!-- Highlights will be dynamically inserted here from Firebase -->
            </div>
            <div class="banner" id="highlights-banner"> 
                <a href="#" target="_blank" rel="noopener noreferrer"> 
                    <img src="https://placehold.co/600x100/111/fff?text=Loading Ad..." alt="Highlights Section Banner" class="banner-image">
                </a> 
            </div>
        </div>
    </div>

    <div id="video-player"> 
        <div id="video-container-wrapper"> 
            <button id="close-btn" onclick="closeVideo()">❌</button> 
            <div class="video-wrapper"> 
                <video id="video" controls autoplay playsinline></video> 
                <div id="video-overlay"> <span id="livefy-text-animator">LIVEFY TV</span> </div> 
            </div> 
        </div> 
        <div id="error-message-box"> 
            <button class="close-error-btn" onclick="hideMessage()">✖</button> 
            <h3 id="error-title">Error (Playback Failure)</h3> 
            <p id="error-text">The video cannot be loaded. The stream link might be invalid, the server may be down, or your device might not support HLS format. Please try another server.</p> 
        </div> 
        <div id="controls-area"> 
            <div id="quality-selector-container"> <label for="quality-select">Video Quality:</label> <select id="quality-select" onchange="changeQuality(this.value)"> <option value="-1">Auto</option> </select> </div> 
            <div id="server-buttons"></div> 
        </div> 
    </div>

    <nav class="bottom-nav"> 
        <div id="nav-home" class="nav-item active" onclick="showTab('home-section', this)"> <svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"></path></svg> <span>Home</span> </div> 
        <div id="nav-channels" class="nav-item" onclick="showTab('sports-channels-section', this)"> <svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M21 3H3c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h5v2h8v-2h5c1.1 0 1.99-.9 1.99-2L23 5c0-1.1-.9-2-2-2zm0 14H3V5h18v12z"></path></svg> <span>Live TV</span> </div> 
        <div id="nav-highlights" class="nav-item" onclick="showTab('highlights-section', this)"> <svg fill="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M17.5 13c-2.34 0-4.59.88-6.23 2.52-1.64 1.64-2.52 3.88-2.52 6.23H5V3h14v10.5h-1.5zm-5.5 3.5c1.38 0 2.5 1.12 2.5 2.5s-1.12 2.5-2.5 2.5-2.5-1.12-2.5-2.5 1.12-2.5 2.5-2.5z"></path></svg> <span>Highlights</span> </div> 
    </nav>
    
<script>
    // ============== Firebase Configuration ================
    const firebaseConfig = {
      apiKey: "AIzaSyCJeCM2sWUY8izlm6Z_T7u4goeRCOxZnaY",
      authDomain: "livefy-9623e.firebaseapp.com",
      databaseURL: "https://livefy-9623e-default-rtdb.firebaseio.com",
      projectId: "livefy-9623e",
      storageBucket: "livefy-9623e.appspot.com",
      messagingSenderId: "211410916294",
      appId: "1:211410916294:web:660f3dfc6ede9a862718c7",
      measurementId: "G-87CYDP39Q2"
    };
    // ======================================================

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    // Global variables
    let hls = null;
    let dynamicMatchesData = [];
    let currentFilter = 'all';

    // DOM Elements
    const video = document.getElementById('video');
    const qualitySelect = document.getElementById('quality-select');
    const qualityContainer = document.getElementById('quality-selector-container');
    const serverButtonsContainer = document.getElementById('server-buttons');
    const navItems = document.querySelectorAll('.nav-item');
    const errorMessageBox = document.getElementById('error-message-box');
    const livefyTextAnimator = document.getElementById('livefy-text-animator');
    const matchTabBtns = document.querySelectorAll('.match-tab-btn');
    const alertModal = document.getElementById('alert-modal');

    // Functions to fetch data from Firebase
    function fetchSettings() {
        database.ref('settings').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                document.getElementById('welcome-text-container').innerText = data.welcomeMessage || 'Welcome!';
                document.getElementById('alert-title-container').innerText = data.alertTitle || 'Alert';
                document.getElementById('alert-message-container').innerText = data.alertMessage || 'Please be careful.';
                const telegramLink = data.telegramLink || '#';
                document.getElementById('telegram-link').href = telegramLink;
                document.getElementById('telegram-link-channels').href = telegramLink;
                document.getElementById('telegram-link-highlights').href = telegramLink;
            }
        });
    }

    function fetchBanners() {
        database.ref('banners').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data) {
                updateBanner('home-banner-top', data.homeTop);
                updateBanner('home-banner-bottom', data.homeBottom);
                updateBanner('channels-banner', data.channels);
                updateBanner('highlights-banner', data.highlights);
            }
        });
    }

    function updateBanner(elementId, bannerData) {
        const bannerElement = document.getElementById(elementId);
        if (bannerElement && bannerData) {
            const link = bannerElement.querySelector('a');
            const img = bannerElement.querySelector('img');
            link.href = bannerData.targetUrl || '#';
            img.src = bannerData.imageUrl || 'https://placehold.co/600x100/111/fff?text=Ad+Space';
            img.onerror = () => { img.src = 'https://placehold.co/600x100/111/fff?text=Ad+Error'; };
        }
    }

    function fetchMatches() {
        const matchesRef = database.ref('matches');
        const container = document.getElementById('match-list-container');

        matchesRef.on('value', (snapshot) => {
            container.innerHTML = '';
            dynamicMatchesData = [];
            const matches = snapshot.val();
            if (matches) {
                for (const matchId in matches) {
                    const match = matches[matchId];
                    dynamicMatchesData.push({
                        id: matchId,
                        start: moment(match.startTime).format('DD/MM/YYYY HH:mm'),
                        end: moment(match.endTime).format('DD/MM/YYYY HH:mm'),
                    });

                    const matchCard = document.createElement('div');
                    matchCard.className = 'match-card';
                    matchCard.id = `match-card-${matchId}`;
                    
                    matchCard.dataset.servers = JSON.stringify(match.servers || []);
                    matchCard.addEventListener('click', function() {
                        const serversData = JSON.parse(this.dataset.servers);
                        openMatchChannels(serversData);
                    });

                    const startTime = moment(match.startTime);
                    matchCard.innerHTML = `
                        <div class="match-title">${match.title || ''}</div>
                        <div class="team">
                            <div>
                                <img src="${match.team1Logo || ''}" alt="Team Logo" onerror="this.onerror=null; this.src='https://placehold.co/45x45/222/fff?text=T1';">
                                <div class="team-name">${match.team1Name || 'Team 1'}</div>
                            </div>
                            <div class="match-info">
                                <div class="match-status-wrapper">
                                    <div class="time" id="time${matchId}">${startTime.format('hh:mm A')}</div>
                                    <div class="date" id="date${matchId}">${startTime.format('DD/MM/YYYY')}</div>
                                    <div id="live${matchId}" class="live-animation hidden">LIVE</div>
                                    <div id="countdown${matchId}" class="countdown-text hidden"></div>
                                    <div id="fulltime${matchId}" class="full-time-text hidden">FULL TIME</div>
                                </div>
                            </div>
                            <div>
                                <img src="${match.team2Logo || ''}" alt="Team Logo" onerror="this.onerror=null; this.src='https://placehold.co/45x45/222/fff?text=T2';">
                                <div class="team-name">${match.team2Name || 'Team 2'}</div>
                            </div>
                        </div>
                        <div class="match-stage">${match.stage || ''}</div>
                    `;
                    container.appendChild(matchCard);
                }
            }
            checkMatchStatus();
            filterMatches(currentFilter, document.querySelector('.match-tab-btn.active-tab'));
        });
    }

    function fetchLiveChannels() {
        const channelsRef = database.ref('liveChannels');
        const container = document.getElementById('channel-grid-container');

        channelsRef.on('value', (snapshot) => {
            container.innerHTML = '';
            const channels = snapshot.val();
            if (channels) {
                for (const channelId in channels) {
                    const channel = channels[channelId];
                    const channelItem = document.createElement('div');
                    channelItem.className = 'channel-item';
                    
                    const channelData = [{ name: channel.name, url: channel.streamUrl }];
                    channelItem.dataset.channel = JSON.stringify(channelData);
                    channelItem.addEventListener('click', function() {
                        const chanData = JSON.parse(this.dataset.channel);
                        openMatchChannels(chanData);
                    });

                    channelItem.innerHTML = `
                        <img src="${channel.logoUrl}" alt="${channel.name}" class="channel-logo">
                        <span class="channel-name">${channel.name}</span>
                        <div class="play-overlay"><i class="fas fa-play play-icon"></i></div>
                    `;
                    container.appendChild(channelItem);
                }
            }
        });
    }

    function fetchHighlights() {
        const highlightsRef = database.ref('highlights');
        const container = document.getElementById('highlights-container');

        highlightsRef.on('value', (snapshot) => {
            container.innerHTML = '';
            const highlights = snapshot.val();
            if (highlights) {
                for (const highlightId in highlights) {
                    const highlight = highlights[highlightId];
                    const highlightCard = document.createElement('div');
                    highlightCard.className = 'highlight-card';

                    const highlightData = [{ name: highlight.title, url: highlight.videoUrl }];
                    highlightCard.dataset.highlight = JSON.stringify(highlightData);
                    highlightCard.addEventListener('click', function() {
                        const hlData = JSON.parse(this.dataset.highlight);
                        openMatchChannels(hlData);
                    });

                    highlightCard.innerHTML = `
                        <img src="${highlight.thumbnailUrl}" alt="Highlight">
                        <div class="info">
                            <p style="font-size: 16px; font-weight: bold;">${highlight.title}</p>
                            <p style="color:#aaa; font-size: 12px;">${highlight.description}</p>
                        </div>
                    `;
                    container.appendChild(highlightCard);
                }
            }
        });
    }
    
    function showAlert() { if (alertModal) alertModal.style.display = 'flex'; }
    function closeAlert() { if (alertModal) alertModal.style.display = 'none'; }
    window.onclick = function(event) { if (event.target == alertModal) closeAlert(); }
    function showMessage(title, message) { document.getElementById('video-container-wrapper').style.display = 'none'; document.getElementById('controls-area').style.display = 'none'; document.getElementById('error-title').textContent = title; document.getElementById('error-text').textContent = message; errorMessageBox.style.display = 'block'; livefyTextAnimator.style.display = 'none'; }
    function hideMessage() { errorMessageBox.style.display = 'none'; document.getElementById('video-container-wrapper').style.display = 'block'; document.getElementById('controls-area').style.display = 'block'; }
    function populateQualitySelector() { qualitySelect.innerHTML = ''; const autoOption = new Option('Auto', -1); qualitySelect.add(autoOption); if (hls && hls.levels && hls.levels.length > 0) { hls.levels.forEach((level, index) => { const resolution = level.height ? `${level.height}p` : 'Unknown'; const bitrate = level.bitrate ? ` (${Math.round(level.bitrate / 1000)}kbps)` : ''; const option = new Option(resolution + bitrate, index); qualitySelect.add(option); }); qualityContainer.style.display = 'flex'; } else { qualityContainer.style.display = 'none'; } qualitySelect.value = hls ? hls.currentLevel : -1; }
    function changeQuality(index) { if (hls) hls.currentLevel = parseInt(index, 10); }
    function showLoading() { livefyTextAnimator.textContent = 'LIVEFY TV - LOADING...'; livefyTextAnimator.classList.add('is-loading'); livefyTextAnimator.style.display = 'block'; }
    function showWatermark() { livefyTextAnimator.textContent = 'LIVEFY TV'; livefyTextAnimator.classList.remove('is-loading'); livefyTextAnimator.style.display = 'block'; }
    function hideWatermark() { livefyTextAnimator.style.display = 'none'; }
    function loadVideoSource(videoSrc) { hideMessage(); showLoading(); if (!videoSrc || videoSrc.startsWith('http://channel-url') || videoSrc.startsWith('http://highlight-url')) { if (hls) { hls.destroy(); hls = null; } video.removeAttribute('src'); video.load(); qualityContainer.style.display = 'none'; showMessage("Error: No Link Found", "No URL found for the video stream or the link is only a demo."); return; } if (hls) { hls.destroy(); hls = null; } video.removeAttribute('src'); video.load(); qualitySelect.innerHTML = '<option value="-1">Auto</option>'; const isHls = videoSrc.toLowerCase().endsWith('.m3u8'); if (isHls && Hls.isSupported()) { qualityContainer.style.display = 'flex'; hls = new Hls({ maxBufferLength: 10, maxMaxBufferLength: 30, fragLoadingMaxRetry: 10, fragLoadingRetryDelay: 500, levelLoadingMaxRetry: 5, abrEwmaFastAveragingTime: 3, abrEwmaSlowAveragingTime: 9, startFragPrefetch: true, liveSyncDurationCount: 3 }); hls.loadSource(videoSrc); hls.attachMedia(video); hls.on(Hls.Events.MANIFEST_PARSED, function() { populateQualitySelector(); if (hls.live) video.currentTime = video.duration - 1; video.play().catch(e => console.log("Video auto-play blocked:", e)); }); hls.on(Hls.Events.LEVEL_SWITCHED, (event, data) => qualitySelect.value = data.level); hls.on(Hls.Events.ERROR, (event, data) => { if (data.fatal) { console.error('HLS.js fatal error:', data); if (hls) { hls.destroy(); hls = null; } showMessage("Fatal Error", "HLS playback failed. The stream link is likely dead or has severe CORS issues. Please try another server."); } }); } else { qualityContainer.style.display = 'none'; video.src = videoSrc; video.load(); const errorHandler = () => { showMessage("Playback Failed", "The video cannot be played in this browser or with this link. The link might be down or the format is unsupported."); video.removeEventListener('error', errorHandler); }; video.addEventListener('error', errorHandler); video.play().catch(e => {}); } }
    function openMatchChannels(channelsData) { document.getElementById('video-player').style.display = 'flex'; serverButtonsContainer.innerHTML = ''; hideMessage(); if (!channelsData || channelsData.length === 0) { showMessage("Error", "No channels found for this match."); loadVideoSource(''); return; } channelsData.forEach(channel => { const button = document.createElement('button'); button.className = 'server-button'; button.textContent = channel.name; button.onclick = () => selectServer(channel.url, button); serverButtonsContainer.appendChild(button); }); const firstButton = serverButtonsContainer.querySelector('.server-button'); if (firstButton) selectServer(channelsData[0].url, firstButton); }
    function selectServer(serverSrc, clickedButton) { document.querySelectorAll('.server-button').forEach(btn => btn.classList.remove('active-server')); if (clickedButton) clickedButton.classList.add('active-server'); loadVideoSource(serverSrc); }
    function closeVideo() { document.getElementById('video-player').style.display = 'none'; if (hls) { hls.destroy(); hls = null; } video.pause(); video.removeAttribute('src'); video.load(); document.getElementById('video-container-wrapper').style.display = 'block'; document.getElementById('controls-area').style.display = 'block'; errorMessageBox.style.display = 'none'; qualitySelect.innerHTML = '<option value="-1">Auto</option>'; qualityContainer.style.display = 'flex'; serverButtonsContainer.innerHTML = ''; hideWatermark(); }
    function showTab(sectionIdToShow, clickedElement) { document.querySelectorAll('.content > div, .content > script').forEach(section => { if (section.id && section.id.endsWith('-section')) { section.classList.add('hidden'); } }); document.getElementById(sectionIdToShow)?.classList.remove('hidden'); navItems.forEach(item => item.classList.remove('active')); clickedElement.classList.add('active'); window.scrollTo({ top: 0, behavior: 'smooth' }); }
    function updateClock() { const now = new Date(); const timeOptions = { hour: '2-digit', minute: '2-digit', second: '2-digit', hour12: true }; const dateOptions = { day: 'numeric', month: 'short', year: 'numeric' }; const timeString = now.toLocaleTimeString('en-US', timeOptions); const dateString = now.toLocaleDateString('en-US', dateOptions); const html = ` <span style="font-size: 14px; display: block;">${timeString}</span> <span class="date-text" style="display: block;">${dateString}</span> `; document.getElementById('time-display-home').innerHTML = html; document.getElementById('time-display-channels').innerHTML = html; document.getElementById('time-display-highlights').innerHTML = html; }
    function checkMatchStatus() { const now = moment(); dynamicMatchesData.forEach(match => { const startMoment = moment(match.start, 'DD/MM/YYYY HH:mm'); const endMoment = moment(match.end, 'DD/MM/YYYY HH:mm'); const timeEl = document.getElementById(`time${match.id}`); const dateEl = document.getElementById(`date${match.id}`); const liveEl = document.getElementById(`live${match.id}`); const countdownEl = document.getElementById(`countdown${match.id}`); const fulltimeEl = document.getElementById(`fulltime${match.id}`); const cardEl = document.getElementById(`match-card-${match.id}`); if (!cardEl) return; [timeEl, dateEl, liveEl, countdownEl, fulltimeEl].forEach(el => el && el.classList.add('hidden')); cardEl.classList.remove('live', 'upcoming', 'recent'); if (now.isBetween(startMoment, endMoment)) { liveEl && liveEl.classList.remove('hidden'); cardEl.classList.add('live'); cardEl.style.order = -1; } else if (now.isBefore(startMoment)) { cardEl.classList.add('upcoming'); const diff = moment.duration(startMoment.diff(now)); const days = Math.floor(diff.asDays()); const hours = diff.hours(); const minutes = diff.minutes(); const seconds = diff.seconds(); let countdownText = ''; if (days > 0) { countdownText = `${days}D ${String(hours).padStart(2, '0')}H ${String(minutes).padStart(2, '0')}M`; } else if (hours > 0) { countdownText = `${String(hours).padStart(2, '0')}H ${String(minutes).padStart(2, '0')}M ${String(seconds).padStart(2, '0')}S`; } else { countdownText = `${String(minutes).padStart(2, '0')}M ${String(seconds).padStart(2, '0')}S`; } if (countdownEl) { countdownEl.textContent = countdownText; countdownEl.classList.remove('hidden'); } timeEl && timeEl.classList.remove('hidden'); dateEl && dateEl.classList.remove('hidden'); cardEl.style.order = startMoment.unix(); } else { cardEl.classList.add('recent'); fulltimeEl && fulltimeEl.classList.remove('hidden'); timeEl && timeEl.classList.remove('hidden'); dateEl && dateEl.classList.remove('hidden'); cardEl.style.order = -endMoment.unix(); } applyMatchFilter(cardEl); }); }
    function applyMatchFilter(cardEl) { if (currentFilter === 'all') { cardEl.classList.remove('hidden'); } else if (cardEl.classList.contains(currentFilter)) { cardEl.classList.remove('hidden'); } else { cardEl.classList.add('hidden'); } }
    function filterMatches(filter, clickedButton) { currentFilter = filter; matchTabBtns.forEach(btn => btn.classList.remove('active-tab')); clickedButton && clickedButton.classList.add('active-tab'); document.querySelectorAll('.match-card').forEach(cardEl => { applyMatchFilter(cardEl); }); }

    document.addEventListener('DOMContentLoaded', () => {
        fetchSettings(); fetchBanners(); fetchMatches(); fetchLiveChannels(); fetchHighlights();
        video.addEventListener('loadstart', showLoading); video.addEventListener('waiting', () => { if (!video.paused) showLoading(); }); video.addEventListener('canplay', showWatermark); video.addEventListener('playing', showWatermark); video.addEventListener('pause', hideWatermark); video.addEventListener('ended', hideWatermark);
        updateClock(); setInterval(updateClock, 1000); setInterval(checkMatchStatus, 1000);
        const defaultTab = document.getElementById('nav-home'); showTab('home-section', defaultTab); filterMatches('all', document.querySelector('.match-tab-btn[onclick*="all"]')); hideWatermark();
    });
</script>
</body>
</html>
